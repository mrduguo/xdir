<h1>${pageTitle}: Backup Derby DB</h1>
		<div class="content_main_level_1">
	<#if (getStringParameter("backupfile")??)>
<@groovy>
	<@sql_init/>
import org.apache.commons.io.FileUtils
def backupfile=model.getStringParameter("backupfile")
if(!backupfile.endsWith(".zip")){
	backupfile="$backupfile${model.pathInfo.getPath(model.pathInfo.getCurrentIndex()-1)}-${timestampForKey(0)}.zip"
}
backupfile=model.app.props.resolveStringValue(backupfile)
tmpFolder=backupfile+".tmp"
sql.executeUpdate("CALL SYSCS_UTIL.SYSCS_BACKUP_DATABASE(?)",[tmpFolder])
org.duguo.xdir.util.io.FileUtil.zip(tmpFolder,backupfile)
new File(tmpFolder).deleteDir()
ouputstring="db backup successfully to<br/>File: $backupfile<br/>Size:"+FileUtils.byteCountToDisplaySize(new File(backupfile).size())

	<@sql_destroy/>
</@groovy><br/>
		<a href="${pageUrl}" accesskey="0">Ok</a>
	<#else>
	<form method="post" action="${pageUrl}">
		<input type="hidden" name="action" value="derbybackup"/>		
		<h3></h3>
		<div><input class="field_input" name="backupfile" value="${"$"}{xdir.dir.data}/backup/db/${model.pathInfo.getPath(model.pathInfo.getCurrentIndex()-1)}-${timestampForKey(0)}.zip"/></div>
		<div>
			<input type="submit" value="Backup" name="submit"/>&nbsp;<a href="${pageUrl}" accesskey="0">Cancel</a>
		</div>
	</form>	
	</#if>
		</div>
