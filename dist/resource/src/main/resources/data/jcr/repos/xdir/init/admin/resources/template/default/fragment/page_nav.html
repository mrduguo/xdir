<#macro page_nav>
	<@page_nav_quick/>
</#macro>
<#macro page_breadcrumb>
		<@page_breadcrumb_paths/>
</#macro>
<#macro page_nav_quick>
	<h3>Navigation</h3>
	<div class="list">
	    <#if (pagePaths?size>2)>
			    <@page_nav_level_1_node pageNavLevel1/>
	    <#elseif (pagePaths?size>1)>
			<#if app.site.parent??>
				<#if app.site.parent.children[app.site.name]??>
				    <@page_nav_level_1_site app.site.parent.children/>
				<#else>
					<@page_nav_level_1_metasiteroot app.site/>
				</#if>
			<#else>
			    <@page_nav_level_1_node pageNavLevel1/>
			</#if>
	    <#else>
			<#if app.site.parent??>
				<#if app.site.parent.parent??>
					<@page_nav_level_1_siteparent app.site.parent.parent.children/>
				<#else>
					<@page_nav_level_1_root app.site.parent/>
				</#if>
			<#else>
				<@page_nav_level_2_root/>
			</#if>
	    </#if>
    </div>
</#macro>
<#macro page_nav_level_1_root sitelink>
	<ul class="left_menu_parent">
		<li><a href="${displayPropertyValue(sitelink.url)}" title="${sitelink.title}">${sitelink.title}</a></li>
		<@page_nav_level_2_site app.site.parent.children/>
	</ul>
</#macro>
<#macro page_nav_level_1_metasiteroot sitelink>
	<ul class="left_menu_parent">
		<li><a href="${displayPropertyValue(sitelink.url)}" title="${sitelink.title}">${sitelink.title}</a></li>
		<@page_nav_level_2_node pageNavLevel2/>
	</ul>
</#macro>
<#macro page_nav_level_1_site currentCollection>
	<ul class="page_nav_currentCollection">
		<#assign parentUrl=displayPropertyValue(app.site.url)>
		<#list currentCollection?keys?sort as key>
			<#if currentCollection[key].title??>
				<#assign currentUrl=displayPropertyValue(currentCollection[key].url)>
				<li><a href="${currentUrl}" title="${currentCollection[key].title}">${currentCollection[key].title}</a></li>
				<#if (parentUrl == currentUrl)>
					<@page_nav_level_2_node pageNavLevel2/>
				</#if>
			</#if>
		</#list>
	</ul>
</#macro>
<#macro page_nav_level_1_siteparent currentCollection>
	<ul class="left_menu_parent">
		<#assign parentUrl=displayPropertyValue(app.site.parent.url)>
		<#assign hasLevel1Site=false>
		<#list currentCollection?keys?sort as key>
			<#assign currentUrl=displayPropertyValue(currentCollection[key].url)>
			<#if (parentUrl == currentUrl)>
				<#assign hasLevel1Site=true>
			</#if>
		</#list>
		<#if hasLevel1Site==false>
			<li><a href="${parentUrl}" title="${app.site.parent.title}">${app.site.parent.title}</a></li>
			<@page_nav_level_2_site app.site.parent.children/>
		<#else>
			<#list currentCollection?keys?sort as key>
			  <#if currentCollection[key].title??>
				<#assign currentUrl=displayPropertyValue(currentCollection[key].url)>
				<li><a href="${currentUrl}" title="${currentCollection[key].title}">${currentCollection[key].title}</a></li>
				<#if (parentUrl == currentUrl)>
					<@page_nav_level_2_site app.site.parent.children/>
				</#if>
			  </#if>
			</#list>
		</#if>
	</ul>
</#macro>
<#macro page_nav_level_1_node parents>
	<ul class="left_menu_parent">
		<#assign pageParentUrl ="" >
		<#list pagePaths as p>
			<#if p.url != pageUrl>
				<#assign pageParentUrl=p.url>
			</#if>
		</#list>
		<#list parents?keys?sort as key>
			<li><@page_nav_link parents[key]/></li>
			<#if (pageParentUrl == parents[key].url)>
				<@page_nav_level_2_node pageNavLevel2/>
			</#if>
		</#list>
	</ul>
</#macro>
<#macro page_nav_level_2_root>
	<ul class="page_nav_sibling">
		<li class="selected"><a href="${pageUrl}" title="${pageTitle}">${pageTitle}</a></li>
		<@page_nav_level_3 pageNavLevel3/>
	</ul>
</#macro>
<#macro page_nav_level_2_site currentCollection>
	<ul class="page_nav_sibling">
		<#assign parentUrl=displayPropertyValue(app.site.url)>
		<#assign hasLevel2Site=false>
		<#list currentCollection?keys?sort as key>
				<#assign currentUrl=displayPropertyValue(currentCollection[key].url)>
				<#if parentUrl==currentUrl>
					<#assign hasLevel2Site=true>
				</#if>
		</#list>
		<#if hasLevel2Site==false>
			<li class="selected"><a href="${pageUrl}" title="${pageTitle}">${pageTitle}</a></li>
			<@page_nav_level_3 pageNavLevel3/>
		<#else>
			<#list currentCollection?keys?sort as key>
				<#if currentCollection[key].title??>
					<#assign currentUrl=displayPropertyValue(currentCollection[key].url)>
					<#if parentUrl==currentUrl>
						<li class="selected"><a href="${currentUrl}" title="${currentCollection[key].title}">${currentCollection[key].title}</a></li>
						<@page_nav_level_3 pageNavLevel3/>
					<#else>
						<li><a href="${currentUrl}" title="${currentCollection[key].title}">${currentCollection[key].title}</a></li>
					</#if>
				</#if>
			</#list>
		</#if>
	</ul>
</#macro>
<#macro page_nav_level_2_node currentCollection>
	<ul class="page_nav_sibling">
		<#list currentCollection?keys?sort as key>
			<#if pageUrl==currentCollection[key].url>
				<li class="selected"><@page_nav_link currentCollection[key]/></li>
				<@page_nav_level_3 pageNavLevel3/>
			<#else>
				<li><@page_nav_link currentCollection[key]/></li>
			</#if>
		</#list>
	</ul>
</#macro>
<#macro page_nav_level_3 currentCollection>
	<#if (currentCollection?size>0 && !(pageProperties["_nav_no_children"]??))>
		<ul class="page_nav_children">
			<#list currentCollection?keys?sort as key>
			  <li><@page_nav_link currentCollection[key]/></li>
			</#list>
		</ul>
	</#if>
</#macro>
<#macro page_nav_link nodeLink>
	<a href="${nodeLink.url}" title="${nodeLink.title}">${nodeLink.title}</a>
</#macro>
<#macro page_breadcrumb_paths>
	<#if app.site.parent??><@page_breadcrumb_display_site_link app.site.parent/></#if>
	<#list pagePaths as p>
		<#if p_has_next>
			<@page_nav_link p/> &raquo;
		</#if>
	</#list>
</#macro>
<#macro page_breadcrumb_display_site_link currentLink>
	<#if currentLink.parent??><@page_breadcrumb_display_site_link currentLink.parent/></#if><a href="${displayPropertyValue(currentLink.url)}">${currentLink.title}</a> &raquo;
</#macro>
